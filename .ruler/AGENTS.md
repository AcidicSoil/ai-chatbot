# AGENTS.md for Repo Root

## Hierarchical Policy

- MUST define global architectural rules for Next.js App Router, Server Actions, Drizzle ORM, and AI SDK usage.
- Child directories MUST inherit these rules and MAY specialize them for specific domains (e.g., Auth, Chat, Database).
- MUST NOT contradict the separation of Server vs. Client components defined here.

## Domain Vocabulary

- **Server Component**: React component capable of async data fetching, unable to use hooks/state.
- **Client Component**: React component marked with `"use client"`, enabling interactivity and hooks.
- **Server Action**: Async function marked with `"use server"`, callable from client or server to perform mutations.
- **Artifact**: A specialized content block (text, code, sheet) generated by AI and rendered interactively.
- **Stream**: Real-time data delivery using `ai` SDK (text deltas, tool calls).

## Next.js App Router conventions

- MUST place route segments in `app/`.
- MUST use `page.tsx` for route UI and `layout.tsx` for wrapping UI.
- MUST use `route.ts` for Route Handlers (API endpoints) when Server Actions are insufficient.
- SHOULD colocate feature-specific components with their routes where appropriate, or in `components/` if shared.

## Server vs Client Components

- MUST use Server Components by default.
- MUST add `"use client"` at the top of files using React hooks (`useState`, `useEffect`) or browser APIs.
- Client Components MUST NOT import server-only modules (e.g., `lib/db`, `lib/ai/providers`).
- Server Components MAY import Client Components; Client Components MUST NOT import Server Components (pass them as `children` instead).

## Data fetching (Server Actions & Drizzle)

- MUST perform database writes via Server Actions or Route Handlers.
- MUST use `lib/db/queries.ts` for all database access.
- MUST NOT instantiate Drizzle clients directly in feature code; use the singleton from `lib/db`.
- Server Actions MUST validate input using Zod schemas before processing.

## Boundaries

- `app/` MUST NOT import directly from `lib/db/migrations`.
- `lib/` modules SHOULD be stateless functions or singletons.
- UI components MUST NOT contain business logic related to payment processing or raw AI provider calls.
